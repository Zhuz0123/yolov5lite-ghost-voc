# v5Lite-ghost-s.yaml
# Ghost 风格 backbone 版 YOLOv5-Lite-s

# number of classes
nc: 20
anchors:
  - [10,13, 16,30, 33,23]
  - [30,61, 62,45, 59,119]
  - [116,90, 156,198, 373,326]

depth_multiple: 1.0
width_multiple: 1.0

#freeze: 10

# ---------------- backbone ----------------
# [from, number, module, args]
# 这里用 Conv + C3 + GhostConv 搭一个轻量 backbone，输出 P3、P4、P5 三个尺度特征
backbone:
  # 0: stem，降采样到 1/4
  - [ -1, 1, Conv, [32, 3, 2] ]          # 0  3 → 32, /2
  - [ -1, 1, Conv, [64, 3, 2] ]          # 1  32 → 64, /4

  # 2: P3/8
  - [ -1, 1, GhostConv, [64, 3, 2] ]     # 2  64 → 64, /8  (P3)
  - [ -1, 1, C3, [64, True] ]            # 3  64 → 64, C3

  # 4: P4/16
  - [ -1, 1, GhostConv, [128, 3, 2] ]    # 4  64 →128, /16 (P4)
  - [ -1, 1, C3, [128, True] ]           # 5  128 →128, C3

  # 6: P5/32
  - [ -1, 1, GhostConv, [256, 3, 2] ]    # 6  128→256, /32 (P5)
  - [ -1, 1, C3, [256, True] ]           # 7  256→256, C3

# ---------------- head ----------------
head:
  # P5 → P4
  - [ 7, 1, Conv, [128, 1, 1] ]          # 8  256→128
  - [ -1, 1, nn.Upsample, [None, 2, 'nearest'] ]  # 9  上采样到 /16
  - [ [ -1, 5 ], 1, Concat, [1] ]        # 10 cat(P5_up, P4) → 128+128=256
  - [ -1, 1, C3, [128, False] ]          # 11 P4 head，输出 128 通道

  # P4 → P3
  - [ -1, 1, Conv, [64, 1, 1] ]          # 12 128→64
  - [ -1, 1, nn.Upsample, [None, 2, 'nearest'] ]  # 13 上采样到 /8
  - [ [ -1, 3 ], 1, Concat, [1] ]        # 14 cat(P4_up, P3) → 64+64=128
  - [ -1, 1, C3, [64, False] ]           # 15 P3 head，输出 64 通道

  # 再下采样回 P4
  - [ -1, 1, Conv, [64, 3, 2] ]          # 16 /8→/16, 64→64
  - [ [ -1, 11 ], 1, Concat, [1] ]       # 17 cat(64, 128) = 192
  - [ -1, 1, C3, [128, False] ]          # 18 P4 head (最终版本)，128 通道

  # 再下采样回 P5
  - [ -1, 1, Conv, [128, 3, 2] ]         # 19 /16→/32, 128→128
  - [ [ -1, 7 ], 1, Concat, [1] ]        # 20 cat(128, 256) = 384
  - [ -1, 1, C3, [256, False] ]          # 21 P5 head (最终版本)，256 通道

  # Detect，注意通道分别是：P3:64, P4:128, P5:256
  - [ [15, 18, 21], 1, Detect, [nc, anchors] ]
